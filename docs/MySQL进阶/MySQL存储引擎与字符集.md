# MySQL 存储引擎和字符集

## MySQL 存储引擎

数据库存储引擎是数据库底层软件组织，数据库管理系统（DBMS）使用数据引擎进行创建、查询、更新和删除数据

!> 不同的存储引擎提供不同的存储机制、索引技巧、锁定水平等功能。现在许多不同的数据库管理系统都支持多种不同的数据引擎。**MySQL的核心就是存储引擎**

### 基本概念

- 存储引擎就是指表的类型。
- 数据库的存储引擎决定了**表在计算机中的存储方式**。
- 用户可以根据不同的存储方式、是否进行事务处理等来选择合适的存储引擎。
- 用户可以根据不同的需求为数据表选择不同的存储引擎, 也可以根据自己的需要编写自己的存储引擎。

### 查看MySQL 存储引擎

- 查看MySQL支持的存储引擎：`SHOW ENGINES`

<div style="text-align: center;"><img alt='202403311626751' src='https://cdn.jsdelivr.net/gh/weno861/image@main/img/202403311626751.png' width=500px> </div>

- 查看当前的默认存储引擎: `show variables like "%storage_engine%";`

<div style="text-align: center;"><img alt='202403311635383' src='https://cdn.jsdelivr.net/gh/weno861/image@main/img/202403311635383.png' width=500px> </div>


### 存储引擎的类型

#### InnoDB存储引擎

1. 基本概念:
    - 是**默认的存储引擎**
    - 为处理**巨大数据量**时的最大性能设计
    - 完全与MySQL服务器整合, InnoDB存储引擎为在主内存中缓存数据和索引而维持它自己的缓冲池
2. 特点:
    - 支持行锁, 支持事务, 支持外键, 支持崩溃后的安全恢复, 不支持全文索引
    - 创建表结构是存储在 `.fim` 文件中, 数据和索引存储在 `.ibd` 文件中
    - 缺点是读写读取效率比较低, 占用的空间也比较大
3. 使用场景:需要**事务支持**、**行级锁定对高并发**有很好的适应能力, 但需要确保查询是通过索引完成、数据更新较为频繁

<div style="text-align: center;"><img alt='202403311631920' src='https://cdn.jsdelivr.net/gh/weno861/image@main/img/202403311631920.png' width=500px> </div>

#### MyISAM 存储引擎

1. 基本概念:
    - 它是基于传统的ISAM类型, ISAM是Indexed Sequential Access Method (有索引的顺序访问方法) 的缩写, 它是存储记录和文件的标准方法
    - MyISAM具有检查和修复表格的大多数工具。MyISAM表格可以被压缩, 而且它们支持全文搜索。
    - 它们**不是事务安全**的, 而且**也不支持外键**
    - 如果事务回滚将造成不完全回滚, 不具有原子性。
    - 如果执行大量的查询操作时, MyISAM是更好的选择
2. 特点:
    - 创建表时会存储为3个文件, 文件的名字与表名相同, 分别是"frm MYD MYI",  `.frm`存储**表结构**, `.MYD`存储**表数据**, `.MYI`存储**表索引**
    - MyISAM的表支持三种存储表分别是：**静态型**, **动态型**, **压缩型**。静态是myisam默认存储格式, 字段是固定长度；动态包括变长字段, 字段长度是不固定的；压缩型要选择工具dimpaik创建占用磁盘空间比较小
    - MyISAM的优势在于磁盘空间比较小, 处理速度快
    - 缺点是不支持事务, 没有事务的完整性, 安全性以及事务的并发性处理  
3. 使用场景：不需要事务支持、并发相对较低、数据修改相对较少、以读为主、数据一致性要求不是非常高

#### MEMORY存储引擎

1. 基本概念:
    - 将表中的数据存放在内存中, 如果数据库重启或发生崩溃, 表中的数据都将消失
    - 非常适合用于存储临时数据的**临时表**, 以及数据仓库中的**纬度表**
    - 默认使用**哈希(HASH)索引**, 而不是B+树索引
    - 速度非常快, 但在使用上还是有一定的限制：**只支持表锁**, **并发性能较差**, 并且不支持TEXT和BLOB列类型。最重要的是, 存储变长字段（varchar）时是按照定常字段（char）的方式进行的, 因此会浪费内存
2. 特点:
    - MySQL的特殊存储引擎, 它是使用在存储下内存中的内容来创建表, 而且所有的数据也是存储在内存中速度快
    - 基于memory的存储引擎实际对应一个磁盘文件, 文件名与表名相同, 类型也与ifim但只存储表结构, 数据存储在内存中有利于快速处理, 可以提高表的处理效率
    - 需要注意服务器需要**足够的内存**来维持数据引擎来使用, 不想使用时需要删除不然系统内存不够
    - 缺点是**数据存储在内存上**, 如果意外断电或发生意外时会造成数据丢失。Memory很少使用到, 生命周期比较短, 一般都是一次性的, 为了我们快速读取
3. 使用场景:需要**很快的读写速度**、对数据的安全性要求较低, MEMORY存储引擎对表的大小有要求, 不能是太大的表。

!> **如何选择合适的存储引擎**？

> 根据它们的优缺点, 是否是存储限制, 空间使用, 对插入数据的速度的要求, 支持外界等等。简单的根据不同情况选择合适的存储引擎
> 
> Imnodb存储引擎支持事务处理, 支持外界同时也指出修复能力和并发限制, 事物的完整性要求比较高, 而且要去变化控制。如果创建时未指定存储引擎也是innodb, 如果需要频繁更新删除操作数据库也可以是innodb存储引擎, 因为innodb支持提交和回滚
> 
> Myisam存储引擎插入数据的速度快, 空间和内存使用比较低, 但是主要用于插入和读取记录, 但是注意myisam不支持事务, 对数据的完整性和并发性那么重要, 主要是对数据的存储读取这时候选着myisam也比较好
> Memory存储引擎把数据存储在内存中, 数据处理的速度快但安全性不高, 而且很快的读取速度对数据库的安全的要去比较低选择memory, 但是memory的生命期比较短一次性比较合适, 而且对对表的大小有要求不能建立比较大的表这一点需要注意。需要建议的零时表可以用memory, 用完释放掉就可以了

<div style="text-align: center;"><img alt='202403311632456' src='https://cdn.jsdelivr.net/gh/weno861/image@main/img/202403311632456.png' width=500px> </div>

## MySQL 字符集

### 字符集

MySQL 字符集包括**字符集**和**校对规则**两个部分

- 字符集用来定义MySQL 用来存储字符串的方式, 默认的字符集为latin 1
- 校对规则定义了比较字符串的方式
- 字符集与校对规则是一对多的关系, 一个字符集至少对应一个校对规则

